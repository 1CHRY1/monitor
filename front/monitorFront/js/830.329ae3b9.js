"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[830],{5848:function(e,l,a){a.d(l,{Z:function(){return _}});var i=a(3396);const t=e=>((0,i.dD)("data-v-5a8c193d"),e=e(),(0,i.Cn)(),e),n=t((()=>(0,i._)("div",{class:"head"},"数据预览",-1))),o={key:1,style:{width:"900px"}},s={key:2,style:{width:"900px"}},u={key:3},d={key:4};function r(e,l,a,t,r,c){const p=(0,i.up)("el-skeleton"),v=(0,i.up)("map-visual"),f=(0,i.up)("excel-visual"),m=(0,i.up)("photo-visual"),g=(0,i.up)("video-visual");return(0,i.wg)(),(0,i.iD)("div",null,[n,e.skeletonFlag?((0,i.wg)(),(0,i.j4)(p,{key:0,rows:5,animated:""})):(0,i.kq)("",!0),e.mapVisualFlag?((0,i.wg)(),(0,i.iD)("div",o,[(0,i.Wm)(v,{shpArray:e.shpArray,movePngArray:e.movePngArray,pngArray:e.pngArray,rasterTileArray:e.rasterTileArray},null,8,["shpArray","movePngArray","pngArray","rasterTileArray"])])):(0,i.kq)("",!0),e.excelVisualFlag?((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(f,{tableNameList:e.tableNameList,sandContentList:e.sandContentList,suspensionList:e.suspensionList,rateDirectionList:e.rateDirectionList,salinityList:e.salinityList,flowSandZList:e.flowSandZList},null,8,["tableNameList","sandContentList","suspensionList","rateDirectionList","salinityList","flowSandZList"])])):(0,i.kq)("",!0),e.photoVisualFlag?((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(m,{photoList:e.photoList},null,8,["photoList"])])):(0,i.kq)("",!0),e.videoVisualFlag?((0,i.wg)(),(0,i.iD)("div",d,[(0,i.Wm)(g,{urls:e.videoURLs},null,8,["urls"])])):(0,i.kq)("",!0)])}a(7658);var c=a(4870),p=a(1198),v=a(3029),f=a(26),m=a(9028),g=a(3577),w=(0,i.aZ)({props:{fileInfo:{type:Object}},components:{MapVisual:p.Z,ExcelVisual:v.Z,PhotoVisual:m.Z,VideoVisual:g.Z},setup(e){const l=(0,c.iH)(!0),a=(0,c.iH)(!1),t=(0,c.iH)(!1),n=(0,c.iH)(!1),o=(0,c.iH)(!1),s=(0,c.iH)([]),u=(0,c.iH)([]),d=(0,c.iH)([]),r=(0,c.iH)([]),p=(0,c.iH)([]),v=(0,c.iH)([]),m=(0,c.iH)([]),g=(0,c.iH)([]),w=(0,c.iH)([]),h=(0,c.iH)([]),y=(0,c.iH)([]),_=(0,c.iH)([]),I=async()=>{let i={zoom:0,center:[]};if(e.fileInfo?.visualId){const l=await(0,f.Te)(e.fileInfo.visualId);i=l?.data.view?JSON.parse(l?.data.view):i}let c=!1,I=!1,b=!1,k=!1;if(e.fileInfo){if("lineVectorTile3D"!==e.fileInfo.visualType&&"lineVectorTile"!==e.fileInfo.visualType||(u.value.push({visualId:e.fileInfo.visualId,type:"line",view:i}),c=!0),"pointVectorTile"!==e.fileInfo.visualType&&"pointVectorTile3D"!==e.fileInfo.visualType||(u.value.push({visualId:e.fileInfo.visualId,type:"circle",view:i}),c=!0),"polygonVectorTile"!==e.fileInfo.visualType&&"polygonVectorTile3D"!==e.fileInfo.visualType||(u.value.push({visualId:e.fileInfo.visualId,type:"fill",view:i}),c=!0),"rasterTile"==e.fileInfo.visualType&&(p.value.push({visualId:e.fileInfo.visualId,view:i}),c=!0),"png"==e.fileInfo.visualType){const l=await(0,f.Pk)(e.fileInfo.visualId);null!=l&&0===l.code&&r.value.push({visualId:e.fileInfo.visualId,coordinates:l.data,view:i}),c=!0}if("movePng"==e.fileInfo.visualType){const l=await(0,f.Pk)(e.fileInfo.visualId);null!=l&&0===l.code&&d.value.push({visualId:e.fileInfo.visualId,coordinates:l.data,view:i}),c=!0}"photo"===e.fileInfo.visualType&&(_.value.push(`/monitor/visual/getPhoto/${e.fileInfo.id}`),I=!0),"video"===e.fileInfo.visualType&&(s.value.push({url:`/monitor/visual/video/${e.fileInfo.id}`,fileName:e.fileInfo.fileName}),k=!0),"sandContent"===e.fileInfo.visualType&&(m.value.push(e.fileInfo.visualId),v.value.push(e.fileInfo.fileName),b=!0),"suspension"===e.fileInfo.visualType&&(g.value.push(e.fileInfo.visualId),v.value.push(e.fileInfo.fileName),b=!0),"rateDirection"===e.fileInfo.visualType&&(w.value.push(e.fileInfo.visualId),v.value.push(e.fileInfo.fileName),b=!0),"salinity"===e.fileInfo.visualType&&(h.value.push(e.fileInfo.visualId),v.value.push(e.fileInfo.fileName),b=!0),"flowSand_Z"===e.fileInfo.visualType&&(y.value.push(e.fileInfo.visualId),v.value.push(e.fileInfo.fileName),b=!0)}a.value=c,t.value=b,n.value=I,o.value=k,l.value=!1};return(0,i.bv)((async()=>{await I()})),{skeletonFlag:l,mapVisualFlag:a,excelVisualFlag:t,shpArray:u,movePngArray:d,pngArray:r,rasterTileArray:p,tableNameList:v,sandContentList:m,suspensionList:g,rateDirectionList:w,salinityList:h,flowSandZList:y,photoVisualFlag:n,photoList:_,videoVisualFlag:o,videoURLs:s}}}),h=a(89);const y=(0,h.Z)(w,[["render",r],["__scopeId","data-v-5a8c193d"]]);var _=y},5134:function(e,l,a){a.r(l),a.d(l,{default:function(){return ol}});a(7658);var i=a(3396),t=a(7139),n=a(9242),o=a(4870),s=a(6583),u=a(6e3);const d=e=>((0,i.dD)("data-v-8e80673a"),e=e(),(0,i.Cn)(),e),r={class:"visual-data-bind"},c=d((()=>(0,i._)("div",{class:"visual-head"},"绑定可视化数据",-1))),p={class:"visual-body"},v={class:"visual-type"},f=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"可视化类型：")],-1))),m={class:"view"},g={class:"flex-item"},w=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"视图缩放层级：")],-1))),h={class:"flex-item"},y=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"视图经度：")],-1))),_={class:"flex-item"},I=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"视图纬度：")],-1))),b={class:"srid"},k=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"矢量SRID：")],-1))),V={class:"coordinate"},D=d((()=>(0,i._)("div",null,[(0,i._)("strong",null,"png坐标位置：")],-1))),T={class:"top"},H={class:"left"},W=d((()=>(0,i._)("span",null,"左：",-1))),C={class:"right"},F=d((()=>(0,i._)("span",null,"右：",-1))),U={class:"bottom"},L={class:"left"},x=d((()=>(0,i._)("span",null,"上：",-1))),j={class:"right"},z=d((()=>(0,i._)("span",null,"下：",-1))),N={class:"upload"},Z=d((()=>(0,i._)("div",{class:"upload-title"},[(0,i._)("strong",null,"可视化衍生数据上传：")],-1))),A={class:"btn"};function P(e,l,a,t,n,o){const s=(0,i.up)("el-option"),u=(0,i.up)("el-option-group"),d=(0,i.up)("el-select"),P=(0,i.up)("el-input-number"),q=(0,i.up)("el-input"),S=(0,i.up)("el-button"),O=(0,i.up)("el-upload"),M=(0,i.up)("el-progress"),R=(0,i.Q2)("loading");return(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",r,[c,(0,i._)("div",p,[(0,i._)("div",v,[f,(0,i.Wm)(d,{modelValue:e.typeValue,"onUpdate:modelValue":l[0]||(l[0]=l=>e.typeValue=l),placeholder:"选择可视化类型",onChange:e.selectChangeHandle},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.options,((e,l)=>((0,i.wg)(),(0,i.j4)(u,{key:l,label:e.label},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.options,(e=>((0,i.wg)(),(0,i.j4)(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue","onChange"])]),(0,i._)("div",m,[(0,i._)("div",g,[w,(0,i.Wm)(d,{modelValue:e.selectValue,"onUpdate:modelValue":l[1]||(l[1]=l=>e.selectValue=l),disabled:e.viewDisabledFlag},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.zoomOptions,(e=>((0,i.wg)(),(0,i.j4)(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])]),(0,i._)("div",h,[y,(0,i.Wm)(P,{modelValue:e.longValue,"onUpdate:modelValue":l[2]||(l[2]=l=>e.longValue=l),max:180,min:-180,disabled:e.viewDisabledFlag},null,8,["modelValue","disabled"])]),(0,i._)("div",_,[I,(0,i.Wm)(P,{modelValue:e.latValue,"onUpdate:modelValue":l[3]||(l[3]=l=>e.latValue=l),max:90,min:-90,disabled:e.viewDisabledFlag},null,8,["modelValue","disabled"])])]),(0,i._)("div",b,[k,(0,i.Wm)(q,{modelValue:e.sridInput,"onUpdate:modelValue":l[4]||(l[4]=l=>e.sridInput=l),disabled:e.sridDisabledFlag,placeholder:"请输入srid值"},null,8,["modelValue","disabled"])]),(0,i._)("div",V,[D,(0,i._)("div",T,[(0,i._)("div",H,[W,(0,i.Wm)(q,{modelValue:e.leftInput,"onUpdate:modelValue":l[5]||(l[5]=l=>e.leftInput=l),disabled:e.coordinateDisabledFlag},null,8,["modelValue","disabled"])]),(0,i._)("div",C,[F,(0,i.Wm)(q,{modelValue:e.rightInput,"onUpdate:modelValue":l[6]||(l[6]=l=>e.rightInput=l),disabled:e.coordinateDisabledFlag},null,8,["modelValue","disabled"])])]),(0,i._)("div",U,[(0,i._)("div",L,[x,(0,i.Wm)(q,{modelValue:e.topInput,"onUpdate:modelValue":l[7]||(l[7]=l=>e.topInput=l),disabled:e.coordinateDisabledFlag},null,8,["modelValue","disabled"])]),(0,i._)("div",j,[z,(0,i.Wm)(q,{modelValue:e.bottomInput,"onUpdate:modelValue":l[8]||(l[8]=l=>e.bottomInput=l),disabled:e.coordinateDisabledFlag},null,8,["modelValue","disabled"])])])]),(0,i._)("div",N,[Z,(0,i.Wm)(O,{ref:"upload",action:"#","auto-upload":!1,"on-change":e.fileChangeHandle,"on-remove":e.fileRemoveHandle},{trigger:(0,i.w5)((()=>[(0,i.Wm)(S,{type:"primary",style:{"margin-right":"10px"},disabled:e.uploadDisabledFlag},{default:(0,i.w5)((()=>[(0,i.Uk)("选择文件")])),_:1},8,["disabled"])])),default:(0,i.w5)((()=>[(0,i.Wm)(S,{type:"success",onClick:e.uploadHandle,disabled:e.uploadDisabledFlag},{default:(0,i.w5)((()=>[(0,i.Uk)(" 上传文件 ")])),_:1},8,["onClick","disabled"])])),_:1},8,["on-change","on-remove"]),e.progressFlag?((0,i.wg)(),(0,i.j4)(M,{key:0,percentage:e.percentage,status:e.status},null,8,["percentage","status"])):(0,i.kq)("",!0)]),(0,i._)("div",A,[(0,i.Wm)(S,{type:"primary",onClick:e.confirmClick},{default:(0,i.w5)((()=>[(0,i.Uk)("确定")])),_:1},8,["onClick"]),(0,i.Wm)(S,{type:"info",onClick:e.cancelClick,disabled:""===e.fileInfo.visualType},{default:(0,i.w5)((()=>[(0,i.Uk)("取消当前绑定")])),_:1},8,["onClick","disabled"])])])])),[[R,e.loading]])}const q=e=>{const l=20971520,a=[];let i=0;while(i<e.size)a.push(e.slice(i,i+l)),i+=l;return a};var S=a(26),O=(0,i.aZ)({props:{fileInfo:{type:Object}},emits:["updateVisualFile"],setup(e,l){const a=(0,o.iH)(),t=(0,o.iH)(8),n=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],u=(0,o.iH)(121),d=(0,o.iH)(32),r=[{label:"基础地理数据",options:[{label:"pointVectorTile（矢量点数据）",value:"pointVectorTile"},{label:"lineVectorTile（矢量线数据）",value:"lineVectorTile"},{label:"polygonVectorTile（矢量面数据）",value:"polygonVectorTile"},{label:"pointVectorTile3D（带有ZM属性的矢量点数据）",value:"pointVectorTile3D"},{label:"lineVectorTile3D（带有ZM属性的矢量线数据）",value:"lineVectorTile3D"},{label:"polygonVectorTile3D（带有ZM属性的矢量面数据）",value:"polygonVectorTile3D"},{label:"png（针对栅格数据，将栅格数据以png的形式加载到地图上）",value:"png"},{label:"movePng（同png，一般呈多组可进行演变）",value:"movePng"},{label:"rasterTile（栅格切片类型）",value:"rasterTile"}]},{label:"数模数据",options:[{label:"rateDirection（流速流向）",value:"rateDirection"},{label:"sandContent（含沙量）",value:"sandContent"},{label:"salinity（含盐度）",value:"salinity"},{label:"suspension（悬移质颗分）",value:"suspension"},{label:"flowSand_Z（流量输沙率）",value:"flowSand_Z"},{label:"tide（潮位）",value:"tide"}]},{label:"物理模型",options:[{label:"photo（图片类型）",value:"photo"},{label:"video（视频类型）",value:"video"}]}],c=(0,o.iH)(""),p=(0,o.iH)(""),v=(0,o.iH)(""),f=(0,o.iH)(""),m=(0,o.iH)(""),g=(0,o.iH)(""),w=(0,o.iH)(!0),h=(0,o.iH)(!0),y=(0,o.iH)(!0),_=(0,o.iH)(!0),I=(0,o.iH)(""),b=(0,o.iH)(!1),k=(0,o.iH)(0),V=(0,o.iH)(!1);let D,T="",H=!0;const W=(0,i.Fl)((()=>e.fileInfo)),C=()=>{p.value="",v.value="",f.value="",m.value="",g.value="",I.value="",b.value=!1,k.value=0,D=void 0,T=""},F=e=>{y.value="png"!==e&&"movePng"!==e,h.value="photo"===e||"video"===e,_.value="polygonVectorTile3D"!==e&&"pointVectorTile3D"!==e&&"lineVectorTile3D"!==e&&"polygonVectorTile"!==e&&"pointVectorTile"!==e&&"lineVectorTile"!==e,w.value="png"!==e&&"movePng"!==e&&"rasterTile"!==e&&"polygonVectorTile3D"!==e&&"pointVectorTile3D"!==e&&"lineVectorTile3D"!==e&&"polygonVectorTile"!==e&&"pointVectorTile"!==e&&"lineVectorTile"!==e,C()},U=(e,l)=>{l.length>1&&a.value.handleRemove(l[0]),D=e,T=""},L=()=>{D=void 0,T="",I.value="",k.value=0,b.value=!1},x=async()=>{if(H)if(H=!1,void 0!=D){T="";const e=q(D.raw),l=e.length;b.value=!0;const a=(0,s.Vj)();let i=!1,t=0;const n=async()=>{if(e.length>0&&!i){const o=e.shift(),s=new FormData;s.append("number",t.toString()),s.append("id",a),s.append("file",o),t++;const u=await(0,S.Eh)(s);null!=u&&0===u.code?(k.value=Math.floor(t/l),n()):i=!0}};for(let o=0;o<5;o++)await n();if(0!==e.length||i)I.value="exception";else{const e=await(0,S.S_)(a,l,c.value,D.name);null!=e&&0===e.code?(I.value="success",T=e.data):I.value="exception"}H=!0}else(0,s.Iv)("warning","警告","请先选项文件");else(0,s.Iv)("warning","警告","请不要重复点击")},j=async()=>{const a={id:e.fileInfo.id,fileName:T,type:c.value,coordinates:[],srid:p.value,view:null};if(""===c.value)return void(0,s.Iv)("warning","警告","请选择类型");if("photo"!==c.value&&"video"!==c.value){if(""==T)return void(0,s.Iv)("warning","警告","请上传文件");if(("polygonVectorTile3D"===c.value||"pointVectorTile3D"===c.value||"lineVectorTile3D"===c.value||"polygonVectorTile"===c.value||"pointVectorTile"===c.value||"lineVectorTile"===c.value)&&""===p.value)return void(0,s.Iv)("warning","警告","srid不能为空");if("png"===c.value||"movePng"===c.value){if(""===v.value||""===f.value||""===m.value||""===g.value)return void(0,s.Iv)("warning","警告","请完善png坐标位置");a.coordinates.push([parseFloat(v.value),parseFloat(m.value)]),a.coordinates.push([parseFloat(f.value),parseFloat(m.value)]),a.coordinates.push([parseFloat(f.value),parseFloat(g.value)]),a.coordinates.push([parseFloat(v.value),parseFloat(g.value)])}if(!w.value){if(""===u.value||""===d.value)return void(0,s.Iv)("warning","警告","视图经纬度不得为空");a.view={zoom:t.value,center:[u.value,d.value]}}}console.log(a),V.value=!0;const i=await(0,S.j$)(a);null!=i&&0===i.code?(l.emit("updateVisualFile",{visualType:c.value,visualId:i.data}),(0,s.Iv)("success","成功","可视化数据绑定成功")):null!=i&&1===i.code&&((0,s.Iv)("warning","警告","当前文件绑定数据条目，若更改可视化绑定需要通过管理审核!"),l.emit("updateVisualFile",{visualType:"audit",visualId:i.msg})),V.value=!1},z=async()=>{const e=await(0,S.mf)(W.value.id);null!=e&&0===e.code&&((0,s.Iv)("success","成功","取消可视化数据绑定"),l.emit("updateVisualFile",{visualType:"",visualId:""}))};return{longValue:u,latValue:d,typeValue:c,selectValue:t,options:r,zoomOptions:n,sridInput:p,leftInput:v,rightInput:f,topInput:m,bottomInput:g,uploadDisabledFlag:h,coordinateDisabledFlag:y,viewDisabledFlag:w,sridDisabledFlag:_,selectChangeHandle:F,uploadHandle:x,status:I,progressFlag:b,fileChangeHandle:U,fileRemoveHandle:L,upload:a,percentage:k,confirmClick:j,cancelClick:z,loading:V,fileInfo:W}}}),M=a(89);const R=(0,M.Z)(O,[["render",P],["__scopeId","data-v-8e80673a"]]);var Y=R,K=a(5848);const E=e=>((0,i.dD)("data-v-540eea08"),e=e(),(0,i.Cn)(),e),B={class:"Create"},$=E((()=>(0,i._)("p",{class:"title"},"创建文件夹",-1))),Q={class:"flex"};function J(e,l,a,t,o,s){return(0,i.wg)(),(0,i.iD)("div",B,[$,(0,i._)("div",Q,[(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{placeholder:"请输入文件名",type:"text",class:"input","onUpdate:modelValue":l[0]||(l[0]=l=>e.input=l),ref:"inputFocus"},null,512),[[n.nr,e.input]])])]),(0,i._)("button",{class:"confirm",onClick:l[1]||(l[1]=(...l)=>e.commit&&e.commit(...l))},"确定")])}var G=(0,i.aZ)({emits:["createFolder"],props:{folderNames:{type:Array}},setup(e,l){const a=(0,o.iH)(""),t=(0,o.iH)(),n=()=>{let i=!0;e.folderNames?.forEach((e=>{e===a.value&&(i=!1)})),i?l.emit("createFolder",a.value):(0,s.Iv)("warning","警告","文件重名!")};return(0,i.Y3)((()=>{t.value?.focus()})),{input:a,commit:n,inputFocus:t}}});const X=(0,M.Z)(G,[["render",J],["__scopeId","data-v-540eea08"]]);var ee=X;const le=e=>((0,i.dD)("data-v-7ad3dd04"),e=e(),(0,i.Cn)(),e),ae={key:1,class:"upload-page"},ie=le((()=>(0,i._)("div",{class:"gif"},[(0,i._)("img",{src:"/gif/upload.gif",alt:""})],-1))),te={key:1,class:"scroll"},ne={class:"btn"},oe=["title"],se=["onClick"],ue=["title"],de=le((()=>(0,i._)("span",null,"等待上传...",-1))),re=["onClick"],ce=["title"],pe={class:"size-time"},ve={class:"file-size"},fe={class:"file-time"},me=["onClick"],ge=le((()=>(0,i._)("div",null,null,-1)));function we(e,l,a,n,o,s){const u=(0,i.up)("el-skeleton"),d=(0,i.up)("el-empty"),r=(0,i.up)("el-button"),c=(0,i.up)("el-progress"),p=(0,i.up)("CircleClose"),v=(0,i.up)("el-icon"),f=(0,i.up)("el-scrollbar");return e.skeleton?((0,i.wg)(),(0,i.j4)(u,{key:0,rows:5,animated:""})):((0,i.wg)(),(0,i.iD)("div",ae,[ie,0===e.uploadedList.length&&0===e.fileList.length&&0===Object.keys(e.uploadingObj).length?((0,i.wg)(),(0,i.j4)(d,{key:0,description:"暂无记录"})):((0,i.wg)(),(0,i.iD)("div",te,[(0,i._)("div",ne,[(0,i.Wm)(r,{type:"primary",link:"",onClick:e.delClick},{default:(0,i.w5)((()=>[(0,i.Uk)("删除所有记录")])),_:1},8,["onClick"])]),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.uploadingObj,((l,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"card",key:a},[(0,i._)("div",{class:"file-name",title:l.file.name},(0,t.zw)(l.file.name),9,oe),(0,i.Wm)(c,{"text-inside":!0,"stroke-width":16,percentage:l.finished},null,8,["percentage"]),(0,i._)("div",{class:"icon",onClick:l=>e.closeHandle("uploading",a)},[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p)])),_:1})],8,se)])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.fileList,((l,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"card",key:a},[(0,i._)("div",{class:"file-name",title:l.file.name},(0,t.zw)(l.file.name),9,ue),(0,i.Wm)(c,{"text-inside":!0,"stroke-width":16,percentage:0},{default:(0,i.w5)((()=>[de])),_:1}),(0,i._)("div",{class:"icon",onClick:l=>e.closeHandle("wait",a)},[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p)])),_:1})],8,re)])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.uploadedList,((l,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"card",key:a},[(0,i._)("div",{class:"file-name",title:l.fileName},(0,t.zw)(l.fileName),9,ce),(0,i.Wm)(c,{"text-inside":!0,"stroke-width":16,percentage:100,status:"success"}),(0,i._)("div",pe,[(0,i._)("div",ve,(0,t.zw)(l.size),1),(0,i._)("div",fe,(0,t.zw)(l.time),1)]),(0,i._)("div",{class:"icon",onClick:i=>e.closeHandle("uploaded",a,l.id)},[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p)])),_:1})],8,me)])))),128))])),_:1})])),ge]))}var he=a(2594);const ye="undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var _e={randomUUID:ye};a(1439),a(7585),a(5315);let Ie;const be=new Uint8Array(16);function ke(){if(!Ie&&(Ie="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ie))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ie(be)}const Ve=[];for(let sl=0;sl<256;++sl)Ve.push((sl+256).toString(16).slice(1));function De(e,l=0){return(Ve[e[l+0]]+Ve[e[l+1]]+Ve[e[l+2]]+Ve[e[l+3]]+"-"+Ve[e[l+4]]+Ve[e[l+5]]+"-"+Ve[e[l+6]]+Ve[e[l+7]]+"-"+Ve[e[l+8]]+Ve[e[l+9]]+"-"+Ve[e[l+10]]+Ve[e[l+11]]+Ve[e[l+12]]+Ve[e[l+13]]+Ve[e[l+14]]+Ve[e[l+15]]).toLowerCase()}function Te(e,l,a){if(_e.randomUUID&&!l&&!e)return _e.randomUUID();e=e||{};const i=e.random||(e.rng||ke)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,l){a=a||0;for(let e=0;e<16;++e)l[a+e]=i[e];return l}return De(i)}var He=Te;const We=(0,he.Q_)("uploadFile",(()=>{const e=(0,o.iH)([]);let l=(0,o.qj)({});const a=(0,o.iH)([]),i=(0,o.iH)(!1),t=async()=>{a.value=[];const e=await(0,S.N1)();e&&0===e.code&&(a.value=e.data)},n=l=>{e.value.push(l)},s=async(e,l)=>{const i=await(0,S.Wi)(e);i&&0===i.code&&a.value.splice(l,1)},u=e=>{l[e].cancel=!0},d=()=>{i.value=!0;const t=()=>new Promise(((i,n)=>{if(console.log(e.value.length),e.value.length){const o=He(),s=e.value.shift(),u={...s,finished:0,cancel:!1};l[o]=u,c(u,o).then((async e=>{e&&0===e.code&&(delete l[o],a.value.unshift(e.data));const s=await t();1===s?i(s):n()})).catch((()=>{delete l[o],n()}))}else console.log("haha"),i(1)})),n=[];for(let e=0;e<5;e++)n.push(t());Promise.all(n).then((e=>{console.log(e),i.value=!1}))};function r(e){const l=5242880,a=[];let i=0;while(i<e.size)a.push(e.slice(i,i+l)),i+=l;return a}const c=(e,a)=>{const i=e.file.name,t=r(e.file);return new Promise(((n,o)=>{let s=0;const u=t.length,d=He(),r=e.parentId,c=async()=>{if(t.length&&!l[a].cancel){const e=new FormData;e.append("file",t.shift()),e.append("number",s.toString()),e.append("id",d);const i=await(0,S.Eh)(e);i&&0===i.code?(s++,l[a].finished=Math.floor(s/u*100),c()):o()}else if(s===u){const e=await(0,S.fB)({parentId:r,fileName:i,id:d,total:u});n(e)}else o()};c()}))};return{fileList:e,uploadedList:a,uploading:i,uploadingObj:l,setUploadedList:t,addFileList:n,executeUpload:d,deleteUploaded:s,deleteUploading:u}}));var Ce=(0,i.aZ)({setup(){const e=We(),l=(0,o.iH)(!0),{uploadingObj:a}=(0,he.Jk)(e),t=(0,i.Fl)((()=>e.fileList)),n=(0,i.Fl)((()=>e.uploadedList)),u=e=>(0,s.vc)(e,"yyyy-MM-dd hh:mm"),d=async(l,a,i)=>{"wait"===l?e.fileList.splice(a,1):"uploaded"===l?await e.deleteUploaded(i,a):e.deleteUploading(i)},r=async()=>{const l=await(0,S.cY)();null!=l&&0===l.code&&(await e.setUploadedList(),(0,s.Iv)("success","成功","删除成功"))};return(0,i.bv)((async()=>{console.log(e.uploadingObj,Object.keys(a.value)),l.value=!0,console.log("123"),await e.setUploadedList(),l.value=!1})),{skeleton:l,uploadingObj:a,fileList:t,uploadedList:n,closeHandle:d,getDate:u,delClick:r}}});const Fe=(0,M.Z)(Ce,[["render",we],["__scopeId","data-v-7ad3dd04"]]);var Ue=Fe,Le=a(8938);const xe=e=>((0,i.dD)("data-v-41fb5c4f"),e=e(),(0,i.Cn)(),e),je={class:"main"},ze={class:"resource-main"},Ne={class:"table-head"},Ze={class:"path"},Ae=xe((()=>(0,i._)("div",{class:"path-item"},"user",-1))),Pe=xe((()=>(0,i._)("div",{class:"path-item separate"},"/",-1))),qe={class:"path-item"},Se=xe((()=>(0,i._)("div",{class:"path-item separate"},"/",-1))),Oe={class:"btn"},Me={key:0,class:"table"},Re={class:"table-name"},Ye={class:"container"},Ke=["onUpdate:modelValue","onChange"],Ee=xe((()=>(0,i._)("div",{class:"checkmark"},null,-1))),Be={class:"table-name"},$e={class:"text"},Qe={style:{width:"28px",height:"28px"}},Je=["xlink:href"],Ge={class:"name"},Xe={style:{"margin-right":"10px"}},el={style:{"margin-right":"10px"}},ll={style:{"margin-right":"10px"}},al={style:{"margin-right":"10px"}},il={key:1};var tl=(0,i.aZ)({__name:"FolderAdminView",setup(e){const l=(0,o.iH)([]),a=(0,o.iH)(),d=(0,o.iH)(!0),r=(0,o.iH)([]),c=(0,o.iH)([]),p=(0,o.iH)([]),v=(0,o.iH)(!1),f=(0,o.iH)(!1),m=(0,o.iH)(!1),g=(0,o.iH)(),w=((0,o.iH)(""),(0,o.iH)(!1)),h=(0,o.iH)(!1),y=We();let _=0;const I=e=>"fileName"in e?e.fileName:e.folderName,b=e=>"size"in e?e.size:"",k=e=>!("fileName"in e),V=async()=>{d.value=!0;let e="";e=0===c.value.length?"-1":c.value[c.value.length-1].id;const l=await(0,S.a2)(e);null!=l&&0===l.code?(Z(l.data),d.value=!1):(Z([]),d.value=!1)},D=e=>{a.value=e,f.value=!0},T=e=>{u.T.confirm("确定删除文件夹及文件夹以下内容","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a={files:[],folders:[]};"folderName"in e?a.folders.push(e.id):a.files.push(e.id),console.log(a);const i=await(0,S.P1)(a);if(null!=i&&0===i.code){for(let a=0;a<l.value.length;a++)if(l.value[a].id===e.id){l.value.splice(a,1);break}(0,s.Iv)("success","成功","删除成功")}else(0,s.Iv)("error","错误","删除失败")})).catch((()=>{}))},H=e=>{console.log(e),a.value=e,m.value=!0},W=async()=>{v.value=!0},C=async e=>{const a={folderName:e,parentId:c.value.length>0?c.value[c.value.length-1].id:""},i=await(0,S.oN)(a);i&&0===i.code?(l.value.push({id:i.data.id,folderName:a.folderName,parentId:a.parentId,flag:!1}),(0,s.Iv)("success","成功","文件夹创建成功！"),v.value=!1):(0,s.Iv)("error","错误","文件夹创建失败！")},F=e=>{for(let i=0;i<l.value.length;i++)if(l.value[i].id===a.value.id){l.value[i].visualType=e.visualType,l.value[i].visualId=e.visualId;break}m.value=!1},U=async()=>{u.T.confirm("确定删除文件夹及文件夹以下内容","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{let e={files:[],folders:[]};for(let l=0;l<r.value.length;l++)"file"===r.value[l].type?e.files.push(r.value[l].id):e.folders.push(r.value[l].id);console.log(e);const a=await(0,S.P1)(e);if(console.log(a),null!=a&&0===a.code){for(let e=0;e<r.value.length;e++)for(let a=0;a<l.value.length;a++)if(l.value[a].id===r.value[e].id){l.value.splice(a,1);break}r.value=[],(0,s.Iv)("success","成功","删除成功")}})).catch((()=>{(0,s.Iv)("error","错误","删除失败")}))},L=async e=>{window.location.href=`/monitor/files/downloadFile/${e.id}`},x=(e,l)=>{console.log(1);let a=l.length;_=Math.max(a,_);let i="";c.value.length&&(i=c.value[c.value.length-1].id),y.addFileList({file:e.raw,finished:0,parentId:i}),setTimeout((()=>{a===_&&(console.log("当前length为最大值",a),console.log(y.uploading),y.uploading||y.executeUpload(),_=0)}))},j=e=>{if(e.flag)"folderName"in e?r.value.push({id:e.id,type:"folder"}):r.value.push({id:e.id,type:"file"});else for(let l=0;l<r.value.length;l++)e.id===r.value[l].id&&r.value.splice(l,1)},z=async e=>{if(q(),"folderName"in e){w.value=!0;const l=await(0,S.a2)(e.id);l&&0===l.code&&(Z(l.data),c.value.push({id:e.id,name:e.folderName,parentId:e.parentId})),w.value=!1}},N=async()=>{if(q(),w.value=!0,c.value.length>0){let e="-1";""!=c.value[c.value.length-1].parentId&&(e=c.value[c.value.length-1].parentId);const l=await(0,S.a2)(e);l&&0===l.code&&(Z(l.data),c.value.pop())}else{w.value=!1;const e=await(0,S.a2)("-1");e&&0===e.code&&(Z(e.data),c.value.pop())}w.value=!1},Z=e=>{l.value=[],e.forEach((e=>{l.value.push({...e,flag:!1})}))};(0,i.bv)((async()=>{const e=await(0,S.a2)("-1");e&&0===e.code&&Z(e.data),d.value=!1}));const A=e=>{const l=k(e);return l?"#icon-wenjianjia":"#icon-wenjian"},P=()=>{for(let e of l.value)e.flag||(e.flag=!0,r.value.push({id:e.id,type:k(e)?"folder":"file"}))},q=()=>{r.value=[];for(let e of l.value)e.flag=!1};return(e,o)=>{const s=(0,i.up)("arrow-left"),u=(0,i.up)("el-icon"),y=(0,i.up)("el-button"),_=(0,i.up)("el-upload"),Z=(0,i.up)("el-empty"),S=(0,i.up)("el-table-column"),O=(0,i.up)("View"),M=(0,i.up)("el-tooltip"),R=(0,i.up)("Link"),E=(0,i.up)("Download"),B=(0,i.up)("Delete"),$=(0,i.up)("el-table"),Q=(0,i.up)("el-skeleton"),J=(0,i.up)("el-dialog"),G=(0,i.up)("el-col"),X=(0,i.up)("el-row"),le=(0,i.up)("el-drawer"),ae=(0,i.Q2)("loading");return(0,i.wg)(),(0,i.iD)("div",je,[(0,i.Wm)(X,{gutter:0,id:"main-elrow"},{default:(0,i.w5)((()=>[(0,i.Wm)(G,{span:16,offset:4},{default:(0,i.w5)((()=>[(0,i._)("div",ze,[(0,i._)("div",Ne,[(0,i.Wm)(u,{size:"20px",onClick:N},{default:(0,i.w5)((()=>[(0,i.Wm)(s)])),_:1}),(0,i._)("div",Ze,[Ae,Pe,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.value,((e,l)=>((0,i.wg)(),(0,i.iD)("div",{key:l,class:"item"},[(0,i._)("div",qe,(0,t.zw)(e.name),1),Se])))),128))]),(0,i._)("div",Oe,[(0,i.Wm)(y,{size:"default",onClick:W},{default:(0,i.w5)((()=>[(0,i.Uk)("创建文件夹")])),_:1}),(0,i.Wm)(y,{size:"default",onClick:V},{default:(0,i.w5)((()=>[(0,i.Uk)("刷新")])),_:1}),(0,i.Wm)(_,{action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,"on-change":x,ref_key:"upload",ref:g},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{type:"primary",size:"default",class:"upload-btn"},{default:(0,i.w5)((()=>[(0,i.Uk)("上传")])),_:1})])),_:1},512),(0,i.Wm)(y,{size:"default",onClick:o[0]||(o[0]=e=>h.value=!0)},{default:(0,i.w5)((()=>[(0,i.Uk)("上传记录")])),_:1})])]),d.value?((0,i.wg)(),(0,i.iD)("div",il,[(0,i.Wm)(Q,{rows:5,animated:""})])):((0,i.wg)(),(0,i.iD)("div",Me,[0===l.value.length?((0,i.wg)(),(0,i.j4)(Z,{key:0,description:"暂无数据"})):(0,i.wy)(((0,i.wg)(),(0,i.j4)($,{key:1,data:l.value,style:{width:"100%"},"max-height":"calc(90vh - 240px - 5rem)",stripe:"",onCellDblclick:z,"highlight-current-row":""},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{width:"40"},{default:(0,i.w5)((e=>[(0,i._)("div",Re,[(0,i._)("label",Ye,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":l=>e.row.flag=l,type:"checkbox",onChange:l=>j(e.row)},null,40,Ke),[[n.e8,e.row.flag]]),Ee])])])),_:1}),(0,i.Wm)(S,{prop:"name",label:"名称",width:"500"},{default:(0,i.w5)((e=>[(0,i._)("div",Be,[(0,i._)("div",$e,[((0,i.wg)(),(0,i.iD)("svg",Qe,[(0,i._)("use",{"xlink:href":A(e.row)},null,8,Je)])),(0,i._)("div",Ge,(0,t.zw)(I(e.row)),1)])])])),_:1}),(0,i.Wm)(S,{prop:"size",label:"大小"},{default:(0,i.w5)((e=>[(0,i._)("span",null,(0,t.zw)(b(e.row)),1)])),_:1}),(0,i.Wm)(S,{align:"right",fixed:"right",width:"300"},{header:(0,i.w5)((()=>[(0,i.Wm)(y,{type:"primary",size:"small",onClick:P,round:""},{default:(0,i.w5)((()=>[(0,i.Uk)("全选")])),_:1}),(0,i.Wm)(y,{type:"primary",size:"small",onClick:q,round:""},{default:(0,i.w5)((()=>[(0,i.Uk)("重置")])),_:1}),(0,i.Wm)(y,{type:"danger",size:"small",disabled:0===r.value.length,"hide-after":50,onClick:U,round:""},{default:(0,i.w5)((()=>[(0,i.Uk)("批量删除")])),_:1},8,["disabled"])])),default:(0,i.w5)((e=>[!k(e.row)&&e.row.visualType?((0,i.wg)(),(0,i.j4)(M,{key:0,effect:"dark",content:"预览",placement:"top","hide-after":50},{default:(0,i.w5)((()=>[(0,i._)("span",Xe,[(0,i.Wm)(y,{size:"small",type:"primary",onClick:l=>D(e.row),plain:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(O)])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)):(0,i.kq)("",!0),k(e.row)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(M,{key:1,effect:"dark",content:"绑定可视化数据",placement:"top","hide-after":50},{default:(0,i.w5)((()=>[(0,i._)("span",el,[k(e.row)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(y,{key:0,size:"small",type:"primary",onClick:l=>H(e.row),plain:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(R)])),_:1})])),_:2},1032,["onClick"]))])])),_:2},1024)),k(e.row)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(M,{key:2,effect:"dark",content:"下载",placement:"top","hide-after":50},{default:(0,i.w5)((()=>[(0,i._)("span",ll,[(0,i.Wm)(y,{size:"small",type:"primary",onClick:l=>L(e.row),plain:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(E)])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)),(0,i.Wm)(M,{effect:"dark",content:"删除",placement:"top","hide-after":50},{default:(0,i.w5)((()=>[(0,i._)("span",al,[(0,i.Wm)(y,{size:"small",type:"primary",onClick:l=>T(e.row),plain:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(B)])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)])),_:1})])),_:1},8,["data"])),[[ae,w.value]])])),(0,i.Wm)(J,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=e=>v.value=e),width:"15%","show-close":!1},{default:(0,i.w5)((()=>[v.value?((0,i.wg)(),(0,i.j4)(ee,{key:0,onCreateFolder:C,folderNames:p.value},null,8,["folderNames"])):(0,i.kq)("",!0)])),_:1},8,["modelValue"]),(0,i.Wm)(J,{modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=e=>f.value=e),"show-close":!1},{default:(0,i.w5)((()=>[f.value?((0,i.wg)(),(0,i.j4)(K.Z,{key:0,fileInfo:a.value},null,8,["fileInfo"])):(0,i.kq)("",!0)])),_:1},8,["modelValue"]),(0,i.Wm)(J,{modelValue:m.value,"onUpdate:modelValue":o[3]||(o[3]=e=>m.value=e),width:"600px","show-close":!1},{default:(0,i.w5)((()=>[m.value?((0,i.wg)(),(0,i.j4)(Y,{key:0,fileInfo:a.value,onUpdateVisualFile:F},null,8,["fileInfo"])):(0,i.kq)("",!0)])),_:1},8,["modelValue"])])])),_:1})])),_:1}),(0,i.Wm)(le,{modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=e=>h.value=e),size:"400px","with-header":!1},{default:(0,i.w5)((()=>[(0,i.Wm)(Ue,{class:"upload"})])),_:1},8,["modelValue"]),(0,i.Wm)(Le.Z,{style:{bottom:"0px"}})])}}});const nl=(0,M.Z)(tl,[["__scopeId","data-v-41fb5c4f"]]);var ol=nl}}]);
//# sourceMappingURL=830.329ae3b9.js.map