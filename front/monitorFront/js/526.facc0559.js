"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[526],{1526:function(e,a,l){l.r(a),l.d(a,{default:function(){return H}});var t=l(3396),o=l(7139),r=l(9242);const d=e=>((0,t.dD)("data-v-f72ca90e"),e=e(),(0,t.Cn)(),e),n={class:"upload-resource"},i={class:"main"},u=d((()=>(0,t._)("div",{class:"head"},[(0,t._)("strong",null,"创建新的共享文件条目")],-1))),s=d((()=>(0,t._)("div",{class:"des"},[(0,t.Uk)(" 请确保以下内容的"),(0,t._)("strong",null,"真实性"),(0,t.Uk)("及"),(0,t._)("strong",null,"完整性"),(0,t.Uk)("，以便管理员审核通过！审核工作预计在7个工作日内完成 ")],-1))),m={ref:"container",class:"container"},p={style:{border:"1px solid #ccc"}},f={class:"btn"};function c(e,a,l,d,c,g){const v=(0,t.up)("el-divider"),w=(0,t.up)("el-input"),h=(0,t.up)("el-form-item"),b=(0,t.up)("el-tag"),y=(0,t.up)("el-button"),V=(0,t.up)("avatar-upload"),_=(0,t.up)("el-form"),W=(0,t.up)("el-option"),C=(0,t.up)("el-option-group"),k=(0,t.up)("el-select"),I=(0,t.up)("data-bind"),U=(0,t.up)("Toolbar"),R=(0,t.up)("Editor"),P=(0,t.up)("page-copyright");return(0,t.wg)(),(0,t.iD)("div",n,[(0,t._)("div",i,[u,s,(0,t.Wm)(v),(0,t.Wm)(_,{"label-width":"130px",model:e.form,rules:e.fileRules,ref:"fileRef"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{label:"条目名：",prop:"name"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.name=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"条目描述：",prop:"description"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.description,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.description=a),type:"textarea",resize:"none",rows:3},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"标签：",prop:"tags"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.form.tags,(a=>((0,t.wg)(),(0,t.j4)(b,{key:a,closable:"","disable-transitions":!1,onClose:l=>e.handleClose(a)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(a),1)])),_:2},1032,["onClose"])))),128)),e.inputVisible?((0,t.wg)(),(0,t.j4)(w,{key:0,ref:"InputRef",class:"tag-input",modelValue:e.inputValue,"onUpdate:modelValue":a[2]||(a[2]=a=>e.inputValue=a),onKeyup:(0,r.D2)(e.handleInputConfirm,["enter"]),onBlur:e.handleInputConfirm},null,8,["modelValue","onKeyup","onBlur"])):((0,t.wg)(),(0,t.j4)(y,{key:1,onClick:e.showInput},{default:(0,t.w5)((()=>[(0,t.Uk)(" + New Tag ")])),_:1},8,["onClick"]))])),_:1}),(0,t.Wm)(h,{label:"条目封面："},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{onReturnPicture:e.returnPicture,pictureName:e.form.avatar,ref:"avatarUpload"},null,8,["onReturnPicture","pictureName"])])),_:1})])),_:1},8,["model","rules"]),(0,t.Wm)(v),(0,t.Wm)(_,{"label-width":"130px",model:e.form,ref:"metaRef",rules:e.metaRules},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{label:"数据提供方：",prop:"provider"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.provider,"onUpdate:modelValue":a[3]||(a[3]=a=>e.form.provider=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"联系电话："},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.providerPhone,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.providerPhone=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"联系邮箱："},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.providerEmail,"onUpdate:modelValue":a[5]||(a[5]=a=>e.form.providerEmail=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"联系地址："},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.providerAddress,"onUpdate:modelValue":a[6]||(a[6]=a=>e.form.providerAddress=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"原始数据类型：",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{modelValue:e.form.type,"onUpdate:modelValue":a[7]||(a[7]=a=>e.form.type=a),placeholder:"数据类型",size:"large",style:{width:"300px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.classList,((e,a)=>((0,t.wg)(),(0,t.j4)(C,{key:a,label:e.lable},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.value,((e,a)=>((0,t.wg)(),(0,t.j4)(W,{key:a,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),"实时水位"===e.form.type?((0,t.wg)(),(0,t.j4)(h,{key:0,label:"绑定水位站："},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{modelValue:e.stationId,"onUpdate:modelValue":a[8]||(a[8]=a=>e.stationId=a),placeholder:"绑定水位站",size:"large",style:{width:"300px"}},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.stationList,((e,a)=>((0,t.wg)(),(0,t.j4)(W,{key:a,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(h,{label:"数据时间："},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.timeStamp,"onUpdate:modelValue":a[9]||(a[9]=a=>e.form.timeStamp=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"空间范围描述："},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{modelValue:e.form.range,"onUpdate:modelValue":a[10]||(a[10]=a=>e.form.range=a)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(h,{label:"空间范围选取："},{default:(0,t.w5)((()=>[(0,t._)("div",m,null,512)])),_:1}),"实时水位"!==e.form.type?((0,t.wg)(),(0,t.j4)(h,{key:1,label:"数据绑定："},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onChangeData:e.changeData,ref:"dataBind"},null,8,["onChangeData"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(h,{label:"其他描述："},{default:(0,t.w5)((()=>[(0,t._)("div",p,[(0,t.Wm)(U,{style:{"border-bottom":"1px solid #ccc"},editor:e.editorRef,defaultConfig:e.toolbarConfig,mode:"default"},null,8,["editor","defaultConfig"]),(0,t.Wm)(R,{style:{height:"320px","overflow-y":"hidden"},modelValue:e.form.detail,"onUpdate:modelValue":a[11]||(a[11]=a=>e.form.detail=a),defaultConfig:e.editorConfig,mode:"default",onOnCreated:e.handleCreated},null,8,["modelValue","defaultConfig","onOnCreated"])])])),_:1})])),_:1},8,["model","rules"])]),(0,t._)("div",f,[(0,t.Wm)(y,{type:"success",plain:"",onClick:a[12]||(a[12]=a=>e.commit(e.fileRef,e.metaRef))},{default:(0,t.w5)((()=>[(0,t.Uk)("修改")])),_:1})]),(0,t.Wm)(P)])}l(7658);var g=l(4870),v=l(6126),w=l(26),h=l(6583),b=l(8296),y=l(9928),V=l(8938),_=l(7709),W=l.n(_),C=l(5884),k=l.n(C),I=l(8993),U=l(3824),R=(0,t.aZ)({components:{Editor:v.M,Toolbar:v.o,AvatarUpload:b.Z,DataBind:y.Z,PageCopyright:V.Z},setup(){const e={children:"children",label:"label"},a=(0,g.iH)(),l=(0,g.iH)(),o=(0,g.iH)(""),r=(0,g.iH)(!1),d=(0,g.iH)(),n=(0,g.iH)(),i=(0,g.qj)({id:"",name:"",location:[],description:"",tags:[],avatar:"",provider:"",range:"",detail:"",type:"",providerPhone:"",providerEmail:"",providerAddress:"",timeStamp:""}),u=(0,g.iH)(""),s=(0,g.iH)([]),m=(0,g.XI)(),p={},f={scroll:!0,autoFocus:!0},c=(0,g.iH)([]),v=(0,g.iH)(),b=(0,g.iH)();let y;const V=e=>{m.value=e},_=e=>{c.value=[],e.forEach((e=>{c.value.push(e.id)}))},C=async(e,a)=>{e&&a&&await e.validate((async(e,l)=>{await a.validate((async a=>{if(e&&a){const e=await(0,w.PR)(i);e&&0===e.code&&(await(0,w.s$)({dataListId:U.ZP.currentRoute.value.params.id,fileIdList:c.value}),(0,h.Iv)("success","成功","数据修改成功"))}}))}))},R=e=>{i.tags.splice(i.tags.indexOf(e),1)},P=()=>{o.value&&i.tags.push(o.value),r.value=!1,o.value=""},j=()=>{r.value=!0,(0,t.Y3)((()=>{d.value.input.focus()}))},H=e=>{console.log(e),i.avatar=e},D=(0,g.qj)({name:[{required:!0,message:"条目名不得为空！",trigger:"blur"}],tags:[{required:!0,message:"标签不得为空！",trigger:"blur"}]}),x=(0,g.qj)({provider:[{required:!0,message:"数据提供方不得为空！",trigger:"blur"}],type:[{required:!0,message:"数据类型不得为空！",trigger:"blur"}],getOnline:[{required:!0,message:"数据获取方式不得为空！",trigger:"blur"}]}),E=new(k())({controls:{combine_features:!1,uncombine_features:!1,trash:!0,point:!1,line_string:!1}}),q=()=>{y=new(W().Map)({container:a.value,style:"mapbox://styles/johnnyt/cl9miecpn001t14rspop38nyk",center:[121.18,31.723],zoom:8,accessToken:"pk.eyJ1Ijoiam9obm55dCIsImEiOiJja2xxNXplNjYwNnhzMm5uYTJtdHVlbTByIn0.f1GfZbFLWjiEayI6hb_Qvg"});const e=function(e){"draw.create"===e.type?(E.getAll().features.length>1&&E.delete(E.getAll().features[0].id),i.location=[],e.features[0].geometry.coordinates[0].forEach((e=>{i.location.push(e[0].toString()),i.location.push(e[1].toString())}))):"draw.update"===e.type?(i.location=[],e.features[0].geometry.coordinates[0].forEach((e=>{i.location.push(e[0].toString()),i.location.push(e[1].toString())}))):"draw.delete"===e.type&&(i.location=[])};y.addControl(E,"top-right"),y.on("draw.create",e),y.on("draw.delete",e),y.on("draw.update",e)},A=e=>{const a=[];for(let l=0;l+1<e.length;l+=2)a.push([parseFloat(e[l]),parseFloat(e[l+1])]);return a};(0,t.Jd)((()=>{const e=m.value;null!=e&&e.destroy()}));const Z=e=>{Promise.all([(0,w.hr)(e),(0,w.g8)(e)]).then((e=>{if(e[0]&&e[1]&&0===e[0].code&&0===e[1].code)if(i.id=e[0].data.id,i.avatar=`/monitor/visual/getAvatar/${e[0].data.avatar}`,i.description=e[0].data.description,i.range=e[0].data.range,i.tags=e[0].data.tags,i.timeStamp=e[0].data.timeStamp,i.type=e[0].data.type,i.detail=e[0].data.detail,i.location=e[0].data.location,i.name=e[0].data.name,i.provider=e[0].data.provider,i.providerAddress=e[0].data.providerAddress,i.providerEmail=e[0].data.providerEmail,i.providerPhone=e[0].data.providerPhone,E.deleteAll(),i.location.length>0&&E.add({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[A(i.location)]}}),"实时水位"!==i.type){const a=e[1].data;l.value.updateData(a),n.value?.updateImage(i.avatar)}else u.value=e[1].data[0].stationId;else U.ZP.push({name:"404"})}))};(0,t.YP)((()=>U.ZP.currentRoute.value.params.id),((e,a)=>{e&&Z(e)}));const S=async()=>{const e=await(0,w.fN)();e&&0===e.code&&(s.value=e.data)};return(0,t.bv)((async()=>{q(),await S(),Z(U.ZP.currentRoute.value.params.id)})),{avatarUpload:n,container:a,form:i,defaultProps:e,inputValue:o,inputVisible:r,InputRef:d,classList:I.s,editorRef:m,toolbarConfig:p,editorConfig:f,handleCreated:V,commit:C,fileRules:D,metaRules:x,fileRef:v,metaRef:b,stationList:s,stationId:u,changeData:_,dataBind:l,handleClose:R,handleInputConfirm:P,showInput:j,returnPicture:H}}}),P=l(89);const j=(0,P.Z)(R,[["render",c],["__scopeId","data-v-f72ca90e"]]);var H=j}}]);
//# sourceMappingURL=526.facc0559.js.map